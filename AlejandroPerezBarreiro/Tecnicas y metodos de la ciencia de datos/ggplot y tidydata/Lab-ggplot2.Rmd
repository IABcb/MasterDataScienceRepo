---
title: "Ejercicio-ggplot2-dplyr"
author: "Felipe Ortega, Isaac Mart칤n"
date: "7 de octubre de 2016"
output: pdf_document
---

## Introducci칩n
El paquete `nycflights13`, disponible en CRAN, contiene datos sobre 336.776 vuelos
que despegaron de alguno de los tres aeropuertos que dan servicio a la ciudad
de Nueva York (EE.UU.) en 2013, procedentes del [Bureau of Transport Statistics](http://www.transtats.bts.gov/DatabaseInfo.asp?DB_ID=120&Link=0):

* Aeropuerto Internacional Libertad de Newark (EWR).
* Aeropuerto Internacional John. F. Kennedy (JFK).
* Aeropuerto Internacional de La Guardia (LGA).

El conjunto principal de datos sobre los vuelos est치 disponible en el `data.frame`
`flights`, dentro de este paquete. Adicionalmente, su autor (Hadley Wickham) tambi칠n ha 
incluido datos sobre los propios aeropuertos, condiciones meteorol칩gicas, etc. Para m치s
detalles, ver archivo de descripci칩n del paquete con el comando `?nycflights13`.

## Preparaci칩n del ejercicio
Durante el ejercicio, se utilizar치n las bibliotecas `ggplot2` y `dplyr`, ya introducidas
en clase.

**Nota importante 1: Se recomienda revisar y practicar con los ejemplos del 
[documento de introducci칩n a
`dplyr`](https://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html) 
antes de realizar este ejercicio**, as칤 como los ejemplos incluidos en el seminario de 
H. Wickham sobre "Tidy Data", enlazado en la secci칩n referencias del Tema 2 en Aula Virtual.

**Nota importante 2: intente utilizar el operador %>% (*forward pipe*) para el c칩digo de resoluci칩n
de todos los ejercicios**.

```{r, message=FALSE}
# Importamos bibliotecas y datos
library(ggplot2)
library(dplyr)
library(nycflights13)
```

## Ejercicio 1 (*30 puntos*)

Utiliza las funciones incluidas en el paquete `dplyr`, para responder a las siguientes preguntas:

a) 쮺uantos vuelos se realizan en total cada mes?
b) 쯈u칠 aeropuerto acumula el mayor n칰mero de salidas de vuelos en todo el a침o?
c) 쯈u칠 compa침칤a acumula el mayor n칰mero de salida de vuelos en los meses de verano (jun-sep.)?
d) 쯈u칠 compa침ia acumula m치s tiempo de vuelo en todo el a침o?
e) 쯈u칠 compa침칤a registra los mayores retrasos de salida de sus vuelos?
쯊ienen los retrasos alguna correlaci칩n con la duraci칩n de los vuelos?

```{r ejercicio-1, warning=FALSE}
## Cuantos vuelos se realizan cada mes
flights %>%
  group_by(month) %>%
  summarise(vuelos = n())
  
## Que aeropuerto tiene el mayor numero de salidas
flights %>%
  group_by(origin) %>%
  summarise(salidas = n()) %>%
  top_n(1)

## Compa寅a con mayor numero de salidas en verano
flights %>%
  filter(month==c(6,7,8,9)) %>%
  group_by(carrier) %>%
  summarise(verano = n()) %>%
  top_n(1)

## Compa寅a con mayor tiempo de vuelo en todo el a絪
flights %>%
  group_by(carrier) %>%
  summarise(tiempo = sum(air_time,na.rm=TRUE)) %>%
  top_n(1)

## Compa寅a con mayor retraso en la salida de los vuelos
flights %>%
  group_by(carrier) %>%
  summarise(tiempo = sum(dep_delay,na.rm=TRUE)) %>%
  top_n(1)
```

## Ejercicio 2 (*30 puntos*)

La siguiente figura, tomada de la [introducci칩n a dplyr](https://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html), muestra
un gr치fico en `ggplot2` de la relaci칩n entre distancia de los vuelos y retraso experimentado
para todos los aeropuertos de NYC.

```{r, warning=FALSE}
by_tailnum <- group_by(flights, tailnum)
delay <- summarise(by_tailnum,
  count = n(),
  dist = mean(distance, na.rm = TRUE),
  delay = mean(arr_delay, na.rm = TRUE))
delay <- filter(delay, count > 20, dist < 2000)

# Interestingly, the average delay is only slightly related to the
# average distance flown by a plane.
ggplot(delay, aes(dist, delay)) +
  geom_point(aes(size = count), alpha = 1/2) +
  labs(x="Distancia (millas)", y="Retraso (mins.)") +
  geom_smooth(method = 'gam') +
  scale_size_area() +
  ggtitle("Relaci칩n entre distancia y retrasos en los vuelos") +
  scale_radius(name="N칰m. vuelos")
```

A la vista del resultado, parece que exista una cierta correlaci칩n negativa, aunque
no muy fuerte, entre ambas variables. Sin embargo, veamos que sucede si desglosamos 
los datos utilizando otras variables disponibles.

En este ejercicio, se propone **representar el retraso de llegadas
en funci칩n de la distancia recorrida**, utilizando una gr치fica como la anterior,
pero desglosado por meses (es decir, una gr치fica como la anterior para cada mes).

La soluci칩n 칩ptima deber칤a construir un panel de 12 gr치ficas, una para cada mes. Cada
gr치fica se debe etiquetar con el nombre abreviado de ese mes, no con el n칰mero de mes. Adem치s,
se debe presentar las gr치ficas en el orden correcto de los meses del calendario
(primero el gr치fico de enero, luego febrero, etc.), no por orden alfab칠tico de los 
nombres del mes.

쯈u칠 conclusiones puedes extraer a la vista de estos gr치ficos? Intenta ofrecer argumentos
basados en los resultados obtenidos para elaborar la respuesta.

```{r, warning=FALSE}
# Introduzca aqu칤 el c칩digo para generar la respuesta
```

*[INTRODUCE AQU칈 LAS CONCLUSIONES]*

## Ejercicio 3 (*20 puntos*)

Representar el retrasos de salida de los vuelos que parten  del aeropuerto JFK 
(c칩digo 'JFK'), desglosado por meses (como en el ejercicio anterior). Se mostrar치n solo
los vuelos dom칠sticos, imponiendo como condici칩n de filtrado de datos:
`distancia recorrida < 1.000 millas`.

쯈u칠 conclusiones puedes extraer a la vista de estos gr치ficos?

```{r}
# Introduzca aqu칤 el c칩digo para generar la respuesta
```

*[INTRODUCE AQU칈 LAS CONCLUSIONES]*

```{r}
# Introduzca aqu칤 el c칩digo para generar la respuesta
```

*[INTRODUCE AQU칈 LAS CONCLUSIONES]*

## Ejercicio 4 (*20 puntos*)
Utilizando boxplots (`geom_boxplot`), representar gr치ficamente una comparativa de los 
retrasos de salida entre las distintas compa침칤as a칠reas, en el mes de diciembre, para el 
aeropuerto de Newark (c칩digo 'EWR'). 쯉e observan diferencias notables?

```{r}
# Introduzca aqu칤 el c칩digo para generar la respuesta
```

*[INTRODUCE AQU칈 LAS CONCLUSIONES]*